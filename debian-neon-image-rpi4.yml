{{- $architecture := or .architecture "arm64" -}}
{{- $firmware_version := or .firmware_version "master" -}}
{{ $suite :=  or .suite "bookworm" }}
{{- $image := or .image "debian-neon-image-rpi4" -}}
{{- $neon_core := or .neon_core "master" -}}
{{- $neon_debos := or .neon_debos "unknown" -}}
{{- $build_cores := or .build_cores 4 -}}

architecture: {{ $architecture }}

actions:
  - action: unpack
    file: rpi4_base.tar.gz

  - action: recipe
    recipe: recipes/31-updater-service.yml
    variables:
      architecture: {{ $architecture }}
      firmware_version: {{ $firmware_version }}
      suite: {{ $suite }}
      image: {{ $image }}

  - action: recipe
    recipe: recipes/33-homeassistant-shortcut.yml
    variables:
      architecture: {{ $architecture }}
      firmware_version: {{ $firmware_version }}
      suite: {{ $suite }}
      image: {{ $image }}

  - action: recipe
    recipe: recipes/40-add-default-user.yml
    variables:
      architecture: {{ $architecture }}
      firmware_version: {{ $firmware_version }}
      suite: {{ $suite }}
      image: {{ $image }}

  - action: recipe
    recipe: recipes/41-install-neon-core.yml
    variables:
      architecture: {{ $architecture }}
      firmware_version: {{ $firmware_version }}
      suite: {{ $suite }}
      image: {{ $image }}
      neon_core: {{ $neon_core }}

  - action: recipe
    recipe: recipes/45-reset-service.yml
    variables:
      architecture: {{ $architecture }}
      firmware_version: {{ $firmware_version }}
      suite: {{ $suite }}
      image: {{ $image }}

  - action: recipe
    recipe: recipes/46-audio-receiver.yml
    variables:
      architecture: {{ $architecture }}
      firmware_version: {{ $firmware_version }}
      suite: {{ $suite }}
      image: {{ $image }}

  - action: recipe
    recipe: recipes/70-developer-extras.yml
    variables:
      architecture: {{ $architecture }}

  - action: recipe
    recipe: recipes/80-extra-fs-overlay.yml
    variables:
      architecture: {{ $architecture }}
      firmware_version: {{ $firmware_version }}
      suite: {{ $suite }}
      image: {{ $image }}

  - action: recipe
    recipe: recipes/81-extra-media-overlay.yml
    variables:
      architecture: {{ $architecture }}

  - action: recipe
    recipe: recipes/90-base-finalscripts.yml
    variables:
      architecture: {{ $architecture }}
      firmware_version: {{ $firmware_version }}
      suite: {{ $suite }}
      image: {{ $image }}

  - action: recipe
    recipe: recipes/95-add_metadata.yml
    variables:
      architecture: {{ $architecture }}
      image: {{ $image }}
      neon_core: {{ $neon_core }}
      neon_debos: {{ $neon_debos }}

  - action: recipe
    recipe: recipes/98-backup-image.yml
    variables:
      architecture: {{ $architecture }}
      firmware_version: {{ $firmware_version }}
      suite: {{ $suite }}
      image: {{ $image }}

  - action: recipe
    recipe: recipes/99-finalize_squashfs.yml
    variables:
      architecture: {{ $architecture }}
      image: {{ $image }}
      build_cores: {{ $build_cores }}
