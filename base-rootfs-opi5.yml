{{- $architecture := or .architecture "arm64" -}}
{{- $firmware_version := or .firmware_version "master" -}}
{{ $suite :=  or .suite "bookworm" }}
{{- $image := or .image "debian-base-image-opi5" -}}
{{- $build_cores := or .build_cores 4 -}}

architecture: {{ $architecture }}

actions:
  - action: recipe
    recipe: recipes/01-debian-base.yml
    variables:
      architecture: {{ $architecture }}
      firmware_version: {{ $firmware_version }}
      suite: {{ $suite }}
      image: {{ $image }}

  - action: recipe
    recipe: recipes/02-orangepi5.yml
    variables:
      architecture: {{ $architecture }}
      firmware_version: {{ $firmware_version }}
      suite: {{ $suite }}
      image: {{ $image }}

  - action: recipe
    recipe: recipes/03-base-packages.yml
    variables:
      architecture: {{ $architecture }}
      firmware_version: {{ $firmware_version }}
      suite: {{ $suite }}
      image: {{ $image }}

  - action: recipe
    recipe: recipes/04-base-overlay.yml
    variables:
      architecture: {{ $architecture }}
      firmware_version: {{ $firmware_version }}
      suite: {{ $suite }}
      image: {{ $image }}

  - action: recipe
    recipe: recipes/05-setup-networking.yml
    variables:
      architecture: {{ $architecture }}
      firmware_version: {{ $firmware_version }}
      suite: {{ $suite }}
      image: {{ $image }}

  - action: recipe
    recipe: recipes/07-splash-screen.yml
    variables:
      architecture: {{ $architecture }}

  - action: recipe
    recipe: recipes/08-poweroff-service.yml
    variables:
      architecture: {{ $architecture }}
      firmware_version: {{ $firmware_version }}
      suite: {{ $suite }}
      image: {{ $image }}

  - action: recipe
    recipe: recipes/09-swap.yml
    variables:
      architecture: {{ $architecture }}

  - action: recipe
    recipe: recipes/11-ovos-font.yml
    variables:
      architecture: {{ $architecture }}
      firmware_version: {{ $firmware_version }}
      suite: {{ $suite }}
      image: {{ $image }}

  - action: recipe
    recipe: recipes/13-audio-devices.yml
    variables:
      architecture: {{ $architecture }}
      firmware_version: {{ $firmware_version }}
      suite: {{ $suite }}
      image: {{ $image }}

  - action: recipe
    recipe: recipes/14-mount-firmware.yml
    variables:
      architecture: {{ $architecture }}

  - action: recipe
    recipe: recipes/09-log2ram.yml
    variables:
      architecture: {{ $architecture }}

  - action: recipe
    recipe: recipes/15-firmware-updates.yml
    variables:
      architecture: {{ $architecture }}

#  - action: recipe
#    recipe: recipes/16-python-3_10.yml
#    variables:
#      architecture: {{ $architecture }}
#      build_cores: {{ $build_cores }}

  - action: recipe
    recipe: recipes/17-locale-config.yml
    variables:
      architecture: {{ $architecture }}

  - action: recipe
    recipe: recipes/27-update-clock.yml
    variables:
      architecture: {{ $architecture }}

  - action: recipe
    recipe: recipes/28-automount-usb.yml
    variables:
      architecture: {{ $architecture }}

#  - action: recipe
#    recipe: recipes/29-ovos-shell.yml
#    variables:
#      architecture: {{ $architecture }}
#      build_cores: {{ $build_cores }}

#  - action: recipe
#    recipe: recipes/41-install-neon-core.yml
#    variables:
#      architecture: {{ $architecture }}
#      firmware_version: {{ $firmware_version }}
#      suite: {{ $suite }}
#      image: {{ $image }}
#      neon_core: dev

#  - action: pack
#    file: rpi4_base.tar.gz

  - action: recipe
    recipe: recipes/70-developer-extras.yml
    variables:
      architecture: {{ $architecture }}

#  - action: recipe
#    recipe: recipes/90-cleanup-build-leftovers.yml
#    variables:
#      architecture: {{ $architecture }}
#      firmware_version: {{ $firmware_version }}
#      suite: {{ $suite }}
#      image: {{ $image }}

#  - action: recipe
#    recipe: recipes/98-backup-image.yml
#    variables:
#      architecture: {{ $architecture }}
#      firmware_version: {{ $firmware_version }}
#      suite: {{ $suite }}
#      image: {{ $image }}

  - action: recipe
    recipe: recipes/96-admin-login.yml
    variables:
      architecture: {{ $architecture }}
      firmware_version: {{ $firmware_version }}
      suite: {{ $suite }}
      image: {{ $image }}

  - action: recipe
    recipe: recipes/98-backup-image.yml
    variables:
      architecture: {{ $architecture }}
      firmware_version: {{ $firmware_version }}
      suite: {{ $suite }}
      image: {{ $image }}

  - action: recipe
    recipe: recipes/99-finalize_squashfs.yml
    variables:
      architecture: {{ $architecture }}
      image: {{ $image }}
      build_cores: {{ $build_cores }}
      platform: opi

#  - action: image-partition
#    imagename: output/{{ $image }}.img
#    imagesize: 7GB
#    partitiontype: gpt
#    diskid: 67d9d0ad-c9a4-a94a-b477-ce3a3e8534e9
#    mountpoints:
#      - mountpoint: /
#        partition: opi_root
#        options: [noatime, commit=600, errors=remount-ro]
#      - mountpoint: /boot
#        partition: opi_boot
#    partitions:
#      - name: opi_boot
#        parttype: bc13c2ff-59e6-4262-a352-b275fd6f7172
#        fsuuid: 9EAC8A2C
#        flags: [bls_boot]
#        fs: fat32
#        start: 61440s
#        end: 2158591s
#      - name: opi_root
#        parttype: 0fc63daf-8483-4772-8e79-3d69d8477de4
#        fsuuid: 23909a83-f34f-42a6-b393-f6adf5cf9c38
#        fs: ext4
#        start: 2158592s
#        end: 100%
#
#  - action: filesystem-deploy
#    description: Deploying filesystem into image
#    setup-kernel-cmdline: false
#    setup-fstab: false
