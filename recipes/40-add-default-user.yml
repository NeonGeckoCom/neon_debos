{{- $default_user := or .default_user "neon" -}}

architecture: {{ .architecture }}

actions:
  - action: apt
    description: Install System Dependencies
    packages:
      - lsb-release
      - cloud-guest-utils
  - action: overlay
    description: Default User Overlay
    source: ../overlays/40-default-user
    destination: /
  - action: run
    description: Configure Default User
    chroot: true
    script: ../scripts/40-configure-default-user.sh {{ $default_user }}
  - action: run
    description: Configure log2ram
    chroot: true
    command: |
      sed "|^PATH_DISK=|s|PATH_DISK=/home/{{ $default_user }}/.local/state/neon|" /etc/log2ram.conf
