{{- $architecture := or .architecture "arm64" -}}
{{- $build_cores := or .build_cores 4 -}}

architecture: {{ $architecture }}

actions:
  - action: run
    description: Ensure /var/tmp directory
    chroot: true
    command: mkdir -p /var/tmp
  - action: apt
    description: GUI Build Dependencies
    packages:
      - breeze-icon-theme
      - cmake
      - extra-cmake-modules
      - g++
      - gettext
      - git-core
      - gstreamer1.0-libav
      - gstreamer1.0-plugins-bad
      - gstreamer1.0-plugins-ugly
      - kirigami2-dev
      - libinput-tools
      - libkf5i18n-dev
      - libkf5kio-dev
      - libkf5notifications-dev
      - libkf5plasma-dev
      - libqt5multimedia5-plugins
      - libqt5websockets5-dev
      - libqt5webview5-dev
      - pkg-config
      - pkg-kde-tools
      - plasma-pa
      - qml-module-qt-labs-folderlistmodel
      - qml-module-qtgraphicaleffects
      - qml-module-qtlocation
      - qml-module-qtmultimedia
      - qml-module-qtpositioning
      - qml-module-qtqml-models2
      - qml-module-qtquick-localstorage
      - qml-module-qtquick-particles2
      - qml-module-qtquick-shapes
      - qml-module-qtquick-templates2
      - qml-module-qtquick-virtualkeyboard
      - qml-module-qtquick-xmllistmodel
      - qml-module-qttest
      - qml-module-qtwayland-compositor
      - qml-module-qtwebchannel
      - qml-module-qtwebengine
      - qml-module-termwidget
      - qmltermwidget-common
      - qt5ct
      - qtbase5-dev
      - qtdeclarative5-dev
      - qtmultimedia5-dev
      - qtwayland5
      - xorg

  - action: overlay
    description: Neon Shell Overlay
    source: ../overlays/29-ovos-shell
    destination: /
  - action: apt
    description: Mesa unstable
    packages:
      - libegl-mesa0/unstable
      - libglx-mesa0/unstable
      - libgl1-mesa-dri/unstable
      - libdrm-radeon1/unstable
      - libx11-data/unstable
      - libglapi-mesa/unstable
      - libx11-6/unstable
      - libllvm17/unstable
      - libdrm-common/unstable
      - libx11-xcb1/unstable
      - libx11-dev/unstable
      - libdrm2/unstable
      - libdrm-amdgpu1/unstable
      - libdrm-nouveau2/unstable
      - libgbm1/unstable

  - action: run
    description: Build Keyboard
    chroot: true
    command: |
      dpkg --force-overwrite -i /opt/qtvirtualkeyboard_patch/qtvirtualkeyboard_5.15.6_arm64.deb || exit 10
      rm -rf /opt/qtvirtualkeyboard_patch || exit 10

  - action: run
    description: Build and Install OVOS Shell and Mycroft GUI
    chroot: true
    script: ../scripts/29-build-ovos-shell.sh {{ $build_cores }}
